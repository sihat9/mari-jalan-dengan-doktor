<!DOCTYPE html><html lang="ms">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pendaftaran Berjalan Bersama Doktor</title>
<style>
/* ——— GAYA dipendekkan ——— */
:root{--primary-color:#2c7be5;--secondary-color:#00d97e;--gray-color:#95aac9;}
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif;}
body{background:#f5f7fa;color:#12263f;}
.container{max-width:800px;margin:auto;padding:20px;}
/* (semua CSS asal anda di sini, tidak diubah) */
</style>
</head>
<body>
<div class="container">
  <!-- ——— HTML BORANG & LAIN‑LAIN KEKAL (dipendekkan) ——— -->
  <form id="registrationForm"> … </form>
  <div id="confirmationMessage" class="hidden"> … </div>
  <div id="counter" class="counter"> … </div>
</div>

<script>
/* ====== KONFIG ====== */
const SCRIPT_URL   = 'https://script.google.com/macros/s/AKfycbwRSq4IDDG59UimVrhA226--hAjbJ0tWocnKvoglY706Bvj6R3jOei3iG8IqtpIUwBC/exec';
const MAX_EARLY    = 10;
let   icSet        = new Set();
let   count        = 0;

/* ====== JSONP loader ====== */
function loadSheetInfo(){
  const tag = document.createElement('script');
  tag.src   = SCRIPT_URL + '?callback=sheetInfo';
  document.body.appendChild(tag);
}
function sheetInfo(data){
  icSet = new Set(data.icList);
  count = data.count;
  document.getElementById('registeredCount').textContent = count;
  document.getElementById('progressBar').style.width = `${Math.min(100,(count/MAX_EARLY)*100)}%`;
}

/* ====== HANTAR BORANG ====== */
document.getElementById('registrationForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const ic = document.getElementById('icNumber').value.trim();
  if (icSet.has(ic)){ alert('IC sudah didaftarkan!'); return; }

  const payload = {
    fullName  : document.getElementById('fullName').value.trim(),
    icNumber  : ic,
    phoneNumber:'6'+document.getElementById('phoneNumber').value.trim(),
    address   : document.getElementById('address').value.trim(),
    email     : document.getElementById('email').value.trim()||'N/A',
    timestamp : new Date().toISOString()
  };

  try{
    await fetch(SCRIPT_URL,{
      method : 'POST',
      mode   : 'no-cors',                 // ← tiada CORS check
      headers: {'Content-Type':'application/json'},
      body   : JSON.stringify(payload)
    });
    /* — anggap berjaya —*/
    icSet.add(ic);
    count++;
    document.getElementById('registeredCount').textContent = count;
    document.getElementById('progressBar').style.width = `${Math.min(100,(count/MAX_EARLY)*100)}%`;
    document.getElementById('registrationForm').style.display='none';
    document.getElementById('confirmationMessage').style.display='block';
    document.getElementById('earlyBirdMessage').textContent =
      count<=MAX_EARLY ? 'Tahniah! Anda antara 10 peserta terawal.' : 'Pendaftaran berjaya.';
  }catch(err){
    alert('Gagal menghantar. Sila cuba lagi.');
    console.error(err);
  }
});

/* ====== HELPER INPUT (IC) ====== */
document.getElementById('icNumber').addEventListener('input', e=>{
  let v=e.target.value.replace(/\D/g,'');
  if(v.length>6)v=v.slice(0,6)+'-'+v.slice(6);
  if(v.length>9)v=v.slice(0,9)+'-'+v.slice(9);
  e.target.value=v.slice(0,14);
});
document.getElementById('phoneNumber').addEventListener('input',e=>{
  e.target.value=e.target.value.replace(/\D/g,'');
});

/* ====== MULA ====== */
loadSheetInfo();          // JSONP panggilan pertama
</script>
</body></html>
