<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pendaftaran Mari Jalan Dengan Doktor</title>

<!-- ==== GAYA ==== -->
<style>
:root{
  --primary:#2c7be5;
  --secondary:#00d97e;
  --dark:#12263f;
  --gray:#95aac9;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif;}
/* Latar belakang: ganti URL di bawah */
body{
  background:url('https://github.com/sihat9/mari-jalan-dengan-doktor/blob/main/img/bg.jpg?raw=true') center/cover fixed no-repeat;
  color:var(--dark);line-height:1.6;position:relative;
}
body::before{content:'';position:absolute;inset:0;background:rgba(255,255,255,.90);z-index:-1;}
.container{max-width:800px;margin:auto;padding:20px;position:relative;}

header{text-align:center;margin-bottom:30px;}
header .logo{display:flex;justify-content:center;align-items:center;gap:15px;margin-bottom:15px;}
header .logo img{max-width:80px;height:auto;}
header .logo-text{font-size:24px;font-weight:700;color:var(--primary);}
header h1{color:var(--primary);margin-bottom:10px;}
header p{color:var(--gray);}

.slider-container{width:100%;border-radius:10px;overflow:hidden;margin-bottom:30px;box-shadow:0 4px 12px rgba(0,0,0,.1);}
.slider{position:relative;height:280px;}
.slide{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity 1s;}
.slide.active{opacity:1;}
.slide-nav{text-align:center;margin-top:10px;}
.slide-nav button{background:var(--primary);border:none;color:#fff;padding:4px 10px;margin:0 4px;border-radius:3px;cursor:pointer;}

form{background:#fff;padding:30px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.05);margin-bottom:30px;}
.form-group{margin-bottom:20px;}label{display:block;margin-bottom:6px;font-weight:500;}
input,textarea{width:100%;padding:12px 14px;border:1px solid #ddd;border-radius:6px;font-size:15px;}
input:focus,textarea:focus{outline:none;border-color:var(--primary);}
.phone-input{display:flex;} .prefix{background:#f0f2f5;padding:12px;border:1px solid #ddd;border-right:none;border-radius:6px 0 0 6px;}
.phone-input input{border-radius:0 6px 6px 0;}
.checkbox-group{display:flex;align-items:center;} .checkbox-group input{width:auto;margin-right:8px;}
.checkbox-consent {
  font-size: 13px;
  color: #666;
  margin-top: 5px;
  margin-left: 28px;
}
.submit-btn{background:var(--primary);color:#fff;border:none;padding:12px;font-size:16px;border-radius:6px;width:100%;font-weight:600;cursor:pointer;}
.submit-btn[disabled]{background:#9cbcff;cursor:not-allowed;}

.info-box{background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.05);margin-bottom:30px;}
.info-box h2{color:var(--primary);margin-bottom:8px;}
.tentatif-link{color:var(--primary);font-weight:500;text-decoration:none;}
.tentatif-link:hover{text-decoration:underline;}

#confirmationMessage{display:none;margin-bottom:30px;}
#confirmationMessage h2{color:var(--primary);margin-bottom:6px;}

/* Loading Spinner */
.loader {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
  margin-right: 8px;
  vertical-align: middle;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Premium Bank Card Style Voucher (Winner) */
#voucherCard {
  display: none;
  margin-top: 30px;
  padding: 25px;
  border-radius: 16px;
  text-align: left;
  background: linear-gradient(135deg, #1a3a6a 0%, #2c7be5 100%);
  color: white;
  position: relative;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  min-height: 220px;
  border: 1px solid rgba(255,255,255,0.2);
}

#voucherCard::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle at center, 
              rgba(255,255,255,0.1) 0%, 
              rgba(255,255,255,0) 70%);
}

#voucherCard::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url('https://raw.githubusercontent.com/sihat9/mari-jalan-dengan-doktor/main/img/poster1.png') center/cover;
  opacity: 0.09;
}

#voucherCard .voucher-content {
  position: relative;
  z-index: 4;
}

#voucherCard .voucher-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

#voucherCard .voucher-header img {
  max-width: 70px;
  height: auto;
  filter: brightness(0) invert(1);
}

#voucherCard .chip {
  width: 50px;
  height: 35px;
  background: linear-gradient(135deg, #ffd700 0%, #c5a600 100%);
  border-radius: 6px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* Chip lines design */
#voucherCard .chip::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    /* Horizontal lines */
    linear-gradient(to bottom, 
      transparent 45%, 
      rgba(0,0,0,0.15) 45%, 
      rgba(0,0,0,0.15) 55%, 
      transparent 55%),
    /* Vertical lines */
    linear-gradient(to right, 
      transparent 45%, 
      rgba(0,0,0,0.15) 45%, 
      rgba(0,0,0,0.15) 55%, 
      transparent 55%),
    /* Shine effect */
    linear-gradient(135deg, 
      rgba(255,255,255,0.3) 0%, 
      rgba(255,255,255,0) 60%);
}

#voucherCard h3 {
  font-size: 20px;
  margin-bottom: 8px;
  font-weight: 600;
  text-shadow: 0 1px 3px rgba(0,0,0,0.3);
  letter-spacing: 0.5px;
}

#voucherCard .voucher-details {
  margin: 25px 0;
}

#voucherCard .voucher-details p {
  margin: 8px 0;
  font-size: 15px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

#voucherCard .voucher-code {
  font-size: 24px;
  font-weight: 700;
  letter-spacing: 3px;
  margin: 15px 0;
  background: rgba(0,0,0,0.15);
  padding: 12px 15px;
  border-radius: 8px;
  display: inline-block;
  font-family: 'Courier New', monospace;
  border: 1px solid rgba(255,255,255,0.2);
  text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  box-shadow: inset 0 1px 3px rgba(255,255,255,0.1);
}

#voucherCard .voucher-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 25px;
  font-size: 13px;
  opacity: 0.9;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

/* Participant Card (Black Background) */
#participantCard {
  display: none;
  margin-top: 30px;
  padding: 25px;
  border-radius: 16px;
  text-align: left;
  background: linear-gradient(135deg, #222 0%, #000 100%);
  color: white;
  position: relative;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  min-height: 220px;
  border: 1px solid rgba(255,255,255,0.1);
}

#participantCard::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle at center, 
              rgba(255,255,255,0.05) 0%, 
              rgba(255,255,255,0) 70%);
}

#participantCard .voucher-content {
  position: relative;
  z-index: 3;
}

#participantCard .voucher-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

#participantCard .voucher-header img {
  max-width: 70px;
  height: auto;
  filter: brightness(0) invert(1);
}

#participantCard h3 {
  font-size: 20px;
  margin-bottom: 8px;
  font-weight: 600;
  text-shadow: 0 1px 3px rgba(0,0,0,0.3);
  letter-spacing: 0.5px;
}

#participantCard .voucher-details {
  margin: 25px 0;
}

#participantCard .voucher-details p {
  margin: 8px 0;
  font-size: 15px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

#participantCard .voucher-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 25px;
  font-size: 13px;
  opacity: 0.9;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.screenshot-tip {
  font-size: 14px;
  color: rgba(255,255,255,0.9);
  margin-top: 15px;
  font-style: italic;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

/* Text emboss effect */
.emboss-text {
  text-shadow: 
    0 1px 0 rgba(255,255,255,0.3),
    0 -1px 0 rgba(0,0,0,0.3);
}

#tentatifModal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;}
#tentatifModal .box{background:#fff;padding:30px;border-radius:10px;max-width:800px;width:90%;max-height:80vh;overflow-y:auto;}
#closeModalBtn{display:block;margin:20px auto 0;padding:8px 24px;background:var(--primary);color:#fff;border:none;border-radius:6px;cursor:pointer;}

.tentatif-item{margin-bottom:15px;display:flex;}
.tentatif-time{font-weight:600;min-width:100px;color:var(--primary);}
.tentatif-content{flex:1;}
.tentatif-highlight{background-color:#f0f8ff;padding:15px;border-radius:8px;margin-bottom:20px;}
.tentatif-highlight .highlight-title{font-weight:700;color:var(--primary);margin-bottom:8px;display:flex;align-items:center;gap:8px;}
.tentatif-doctors{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0;}
.doctor-badge{background:#e6f2ff;color:var(--primary);padding:5px 10px;border-radius:15px;font-size:14px;}
.activity-badge{background:#e6ffe6;color:#006400;padding:5px 10px;border-radius:15px;font-size:14px;margin-top:10px;display:inline-block;}

/* Countdown Timer */
.countdown-container {
  position: absolute;
  right: 20px;
  top: 20px;
  background: rgba(255,255,255,0.9);
  padding: 10px 15px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  text-align: center;
}

.countdown-title {
  font-size: 12px;
  color: var(--primary);
  font-weight: 600;
  margin-bottom: 5px;
}

.countdown-timer {
  font-size: 18px;
  font-weight: 700;
  color: var(--dark);
}

.countdown-days {
  color: var(--primary);
}

.countdown-lagi {
  font-size: 14px;
  margin-left: 5px;
  color: var(--primary);
}

@media (max-width: 768px) {
  .countdown-container {
    position: static;
    margin-top: 15px;
  }
}
</style>
</head>
<body>
<div class="container">

 <!-- HEADER -->
<header>
  <div class="logo">
    <!-- GANTI logo sebenar klinik -->
    <img src="https://github.com/sihat9/mari-jalan-dengan-doktor/blob/main/img/logo-kss.png?raw=true" alt="Logo Klinik">
    <span class="logo-text">Klinik SihatSokmo</span>
  </div>
  <div class="countdown-container">
    <div class="countdown-title">PROGRAM INI AKAN BERMULA DALAM</div>
    <div class="countdown-timer"><span id="countdown-days" class="countdown-days">00</span> Hari <span id="countdown-hours">00</span>:<span id="countdown-minutes">00</span>:<span id="countdown-seconds">00</span> <span class="countdown-lagi">Lagi!</span></div>
  </div>
  <h1>Pendaftaran Program "Mari Jalan Dengan Doktor"</h1>
  <p class="blinking-text">10 peserta yang terawal mendaftar akan berpeluang menebus hadiah istimewa!</p>
</header>

<style>
  /* Tambah dalam bahagian CSS */
  .blinking-text {
    color: #FF0000; /* Warna merah */
    font-weight: bold;
    animation: blink 1s infinite;
    text-shadow: 0 0 5px rgba(255,0,0,0.5); /* Efek glow merah */
  }
  
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }
</style>

  <!-- SLIDER -->
  <div class="slider-container">
    <div class="slider">
      <!-- GANTI 4 poster -->
      <div class="slide active" style="background-image:url('https://github.com/sihat9/mari-jalan-dengan-doktor/blob/main/img/poster1.png?raw=true');"></div>
      <div class="slide"        style="background-image:url('https://github.com/sihat9/mari-jalan-dengan-doktor/blob/main/img/poster2.png?raw=true');"></div>
      <div class="slide"        style="background-image:url('https://github.com/sihat9/mari-jalan-dengan-doktor/blob/main/img/poster3.png?raw=true');"></div>
      <div class="slide"        style="background-image:url('https://github.com/sihat9/mari-jalan-dengan-doktor/blob/main/img/poster4.png?raw=true');"></div>
    </div>
    <div class="slide-nav">
      <button class="nav-btn" data-i="0">1</button><button class="nav-btn" data-i="1">2</button><button class="nav-btn" data-i="2">3</button>
    </div>
  </div>

  <!-- BORANG -->
  <form id="regForm">
    <div class="form-group"><label>Nama Penuh:</label><input id="fullName" required></div>
    <div class="form-group"><label>No. Kad Pengenalan:</label><input id="ic" placeholder="901231-01-1234" pattern="[0-9]{6}-[0-9]{2}-[0-9]{4}" required></div>
    <div class="form-group"><label>No. Telefon:</label><div class="phone-input"><span class="prefix">6</span><input id="phone" pattern="[0-9]{9,11}" required></div></div>
    <div class="form-group"><label>Alamat:</label><textarea id="addr" rows="3" required></textarea></div>
    <div class="form-group"><label>Email (optional):</label><input id="mail" type="email"></div>
    <div class="form-group checkbox-group">
      <input type="checkbox" id="agree" required>
      <label for="agree">Saya akui maklumat ini adalah benar.</label>
    </div>
    <div class="form-group checkbox-group">
      <input type="checkbox" id="consent" required>
      <label for="consent">Dengan ini, saya bersetuju maklumat peribadi saya akan dikumpul dan diproses mengikut Akta Perlindungan Data Peribadi 2010 (Akta 709) untuk tujuan program kesihatan ini.</label>
    </div>
    <button id="submitBtn" class="submit-btn" disabled><span id="submitText">Memuat data…</span></button>
  </form>

  <!-- INFO BOX -->
  <div class="info-box">
    <h2>Tentatif Program</h2>
    <p>Lihat jadual aktiviti program kami.</p>
    <a href="#" id="tentatifBtn" class="tentatif-link">Klik di sini untuk lihat butiran</a>
  </div>

  <!-- CONFIRMATION + VOUCHER -->
  <div id="confirmationMessage">
    <h2>Pendaftaran Berjaya!</h2>
    <p id="msgLine"></p>
    
    <!-- Winner Card (for first 10 participants) -->
    <div id="voucherCard">
      <div class="voucher-content">
        <div class="voucher-header">
          <div class="chip"></div>
          <img src="https://github.com/sihat9/mari-jalan-dengan-doktor/blob/main/img/logo-kss.png?raw=true" alt="Logo Klinik">
        </div>
        <div class="voucher-details">
          <h3 class="emboss-text">BAUCAR HADIAH 10 PESERTA TERAWAL</h3>
          <p><strong>Nama:</strong> <span id="vName" class="emboss-text"></span></p>
          <p><strong>No. IC:</strong> <span id="vIc" class="emboss-text"></span></p>
          <p class="voucher-code emboss-text" id="vCode"></p>
          <p><strong>Tarikh Tamat:</strong> <span class="emboss-text">31/07/2025</span></p>
        </div>
        <div class="voucher-footer">
          <span class="emboss-text">Program Mari Jalan Dengan Doktor</span>
          <span class="emboss-text">Klinik SihatSokmo</span>
        </div>
        <p class="screenshot-tip">Sila screenshot kad ini & tunjuk di kaunter penebusan</p>
      </div>
    </div>
    
    <!-- Participant Card (for other participants) -->
    <div id="participantCard">
      <div class="voucher-content">
        <div class="voucher-header">
          <img src="https://github.com/sihat9/mari-jalan-dengan-doktor/blob/main/img/logo-kss.png?raw=true" alt="Logo Klinik">
        </div>
        <div class="voucher-details">
          <h3 class="emboss-text">PESERTA PROGRAM</h3>
          <p><strong>Nama:</strong> <span id="pName" class="emboss-text"></span></p>
          <p><strong>No. IC:</strong> <span id="pIc" class="emboss-text"></span></p>
          <p><strong>Tarikh Program:</strong> <span class="emboss-text">26/07/2025</span></p>
        </div>
        <div class="voucher-footer">
          <span class="emboss-text">Program Mari Jalan Dengan Doktor</span>
          <span class="emboss-text">Klinik SihatSokmo</span>
        </div>
        <p class="screenshot-tip">Sila screenshot kad ini sebagai bukti pendaftaran</p>
      </div>
    </div>
  </div>

  <!-- MODAL TENTATIF -->
  <div id="tentatifModal">
    <div class="box">
      <h2 style="color:var(--primary);text-align:center;margin-bottom:20px;">Tentatif Program "Mari Jalan Dengan Doktor"</h2>
      
      <div class="tentatif-highlight">
        <div class="highlight-title">🗓 Maklumat Program</div>
        <p><strong>Tarikh:</strong> Sabtu, 26 Julai 2025</p>
        <p><strong>Masa:</strong> 7.30 pagi – 9.30 pagi (Aktiviti Mari Jalan Dengan Doktor)</p>
        <p><strong>Lokasi:</strong> Perkarangan Parkir, Klinik SihatSokmo </p>
      </div>  
      <div style="margin-bottom:15px;">
        <div class="tentatif-item">
          <div class="tentatif-time">7.15 pagi</div>
          <div class="tentatif-content">
            <strong>Pendaftaran peserta</strong>
            <p>Pendaftaran program (Jika ada peserta yang belum mendaftar). Disediakan air mineral dan sarapan ringan </p>
          </div>
        </div>
        
        <div class="tentatif-item">
          <div class="tentatif-time">7.30 pagi</div>
          <div class="tentatif-content">
            <strong>Penerangan program</strong>
            <p>Taklimat tentang tujuan program "Mari Jalan Dengan Doktor" dan faedah kesihatan</p>
            <p>Maklumat tentang program tambahan pada hari tersebut:</p>
            <div class="activity-badge">Semakan Kelayakan Ujian Saringan Percuma PEKAB40 (9.00 pagi - 11.30 pagi)</div>
            <div class="activity-badge">Kempen Derma Darah (9.00 pagi - 2.30 petang)</div>
            <div class="activity-badge">Pemeriksaan Mata Percuma (9.00 pagi - 12.30 tengahari)</div>
            <div class="activity-badge">Aktiviti Mewarna untuk Kanak-kanak</div>
          </div>
        </div>
        
        <div class="tentatif-item">
          <div class="tentatif-time">7.40 pagi</div>
          <div class="tentatif-content">
            <strong>Mula aktiviti berjalan</strong>
            <p>Sembang santai bersama doktor pakar:</p>
            <div class="tentatif-doctors">
              <span class="doctor-badge">👩‍⚕️ Pakar Perubatan</span>
              <span class="doctor-badge">👨‍⚕️ Pakar Diet & Pemakanan</span>
              <span class="doctor-badge">👨‍⚕️ Pakar Kecergasan & Sukan</span>
              <span class="doctor-badge">👩‍⚕️ Pakar Perubatan Keluarga</span>
            </div>
            <p>Berhenti di checkpoint untuk regangan dan penerangan kesihatan</p>
          </div>
        </div>
        
        <div class="tentatif-item">
          <div class="tentatif-time">8.40 pagi</div>
          <div class="tentatif-content">
            <strong>Tamat program berjalan</strong>
            <p>Peserta berehat dan boleh menikmati minuman</p>
          </div>
        </div>
        
        <div class="tentatif-item">
          <div class="tentatif-time">8.50 pagi</div>
          <div class="tentatif-content">
            <strong>Ucapan ringkas</strong>
            <p>Wakil doktor memberikan ucapan penutup</p>
          </div>
        </div>
        
        <div class="tentatif-item">
          <div class="tentatif-time">9.00 pagi</div>
          <div class="tentatif-content">
            <strong>Program tambahan bermula</strong>
            <p>Semakan kelayakan ujian saringan percuma PEKAB40 (9 pagi sehingga 11.30 pagi)</p>
            <p>Kempen derma darah (9 pagi sehingga 2.30 petang)</p>
            <p>Pemeriksaan mata percuma (9 pagi sehingga 12.30 tengahari)</p>
            <p>Aktiviti mewarna untuk kanak-kanak</p>
          </div>
        </div>
      </div>
      
      <div style="background:#fff8e6;padding:15px;border-radius:8px;margin-top:20px;">
        <p><strong>📌 Nota:</strong></p>
        <p>1. Peserta dinasihatkan memakai pakaian menutup aurat dan kasut sukan yang sesuai</p>
        <p>2. Bawa topi dan air minuman tambahan jika perlu</p>
        <p>3. Aktiviti terbuka kepada semua peringkat umur</p>
        <p>4. Kanak-kanak bawah 12 tahun perlu ditemani ibu bapa/penjaga</p>
      </div>
      
      <button id="closeModalBtn">Tutup</button>
    </div>
  </div>
</div>

<!-- ==== SCRIPT ==== -->
<script>
document.addEventListener('DOMContentLoaded',()=>{
const SCRIPT_URL='https://script.google.com/macros/s/AKfycbwRSq4IDDG59UimVrhA226--hAjbJ0tWocnKvoglY706Bvj6R3jOei3iG8IqtpIUwBC/exec';
const $=id=>document.getElementById(id);
let icSet=new Set(),count=0,ready=false;

/* Slider */
(()=>{const s=document.querySelectorAll('.slide'),b=document.querySelectorAll('.nav-btn');let cur=0,timer;
  const go=i=>{s[cur].classList.remove('active');cur=i;s[cur].classList.add('active');};
  const auto=()=>timer=setInterval(()=>go((cur+1)%s.length),5000);
  b.forEach(btn=>btn.onclick=()=>{clearInterval(timer);go(+btn.dataset.i);auto();});auto();})();

/* Modal - automatically show on page load */
$('tentatifModal').style.display='flex';
$('closeModalBtn').onclick=()=>$('tentatifModal').style.display='none';
$('tentatifModal').onclick=e=>{if(e.target===$('tentatifModal'))$('tentatifModal').style.display='none';};
$('tentatifBtn').onclick=e=>{e.preventDefault();$('tentatifModal').style.display='flex';};

/* Countdown Timer */
function updateCountdown() {
  const programDate = new Date('2025-07-26T07:30:00'); // 26 Julai 2025, 7:30 pagi
  const now = new Date();
  const diff = programDate - now;
  
  if (diff <= 0) {
    $('countdown-days').textContent = '00';
    $('countdown-hours').textContent = '00';
    $('countdown-minutes').textContent = '00';
    $('countdown-seconds').textContent = '00';
    return;
  }
  
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((diff % (1000 * 60)) / 1000);
  
  $('countdown-days').textContent = days.toString().padStart(2, '0');
  $('countdown-hours').textContent = hours.toString().padStart(2, '0');
  $('countdown-minutes').textContent = minutes.toString().padStart(2, '0');
  $('countdown-seconds').textContent = seconds.toString().padStart(2, '0');
}

// Update countdown every second
updateCountdown();
setInterval(updateCountdown, 1000);

/* JSONP */
function loadInfo(cb){
  const fn='cb'+Date.now(),tag=document.createElement('script');
  window[fn]=d=>{icSet=new Set(d.icList||[]);count=d.count||0;ready=true;$('submitBtn').disabled=false;$('submitText').textContent='Daftar Sekarang';clean();cb&&cb(true);};
  const clean=()=>{delete window[fn];tag.remove();};
  tag.src=`${SCRIPT_URL}?callback=${fn}`;tag.onerror=()=>{clean();cb&&cb(false);};document.body.appendChild(tag);
  setTimeout(()=>{if(!ready){cb&&cb(false);}},5000);
}
loadInfo();

/* Util */
const genCode=ic=>ic.replace(/\D/g,'').slice(-4)+'-'+Date.now().toString().slice(-6);

/* Submit */
$('regForm').addEventListener('submit',async e=>{
  e.preventDefault();
  if(!ready)return alert('Data belum dimuat.');
  const ic=$('ic').value.trim();
  if(icSet.has(ic))return alert('IC sudah didaftarkan.');
  if(!$('agree').checked)return alert('Sila setujui pengesahan maklumat.');
  if(!$('consent').checked)return alert('Sila berikan kebenaran pemprosesan data.');

  const data={fullName:$('fullName').value.trim(),icNumber:ic,phoneNumber:'6'+$('phone').value.trim(),address:$('addr').value.trim(),email:$('mail').value.trim()||'N/A',timestamp:new Date().toISOString()};
  
  // Show loading spinner
  $('submitBtn').disabled=true;
  $('submitText').innerHTML = '<span class="loader"></span> Sedang memproses...';
  
  try{
    await fetch(SCRIPT_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
    loadInfo(ok=>{
      $('regForm').style.display='none';$('confirmationMessage').style.display='block';
      const early=ok && count<=10;
      $('msgLine').textContent=early?'Tahniah! Anda antara 10 peserta terawal yang mendaftar untuk program ini.':'Tahniah! Anda telah berjaya didaftarkan untuk program ini.';
      
      // Set name and IC for both cards
      $('vName').textContent = data.fullName;
      $('vIc').textContent = data.icNumber;
      $('pName').textContent = data.fullName;
      $('pIc').textContent = data.icNumber;
      
      if(early){
        $('voucherCard').style.display='block';
        $('participantCard').style.display='none';
        $('vCode').textContent=genCode(ic);
      } else {
        $('voucherCard').style.display='none';
        $('participantCard').style.display='block';
      }
    });
  }catch{
    alert('Gagal menghantar.');
    $('submitBtn').disabled=false;
    $('submitText').textContent='Daftar Sekarang';
  }
});

/* Input format */
$('ic').addEventListener('input',e=>{
  let v=e.target.value.replace(/\D/g,'');
  if(v.length>6)v=v.slice(0,6)+'-'+v.slice(6);
  if(v.length>9)v=v.slice(0,9)+'-'+v.slice(9);
  e.target.value=v.slice(0,14);
});
$('phone').addEventListener('input',e=>e.target.value=e.target.value.replace(/\D/g,''));
});
</script>
</body>
</html>
