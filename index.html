<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pendaftaran Berjalan Bersama Doktor</title>

<style>
/* ———— GAYA ASAL & TAMBAHAN ———— */
:root{--primary-color:#2c7be5;--secondary-color:#00d97e;--danger-color:#e63757;--light-color:#f9fafd;--dark-color:#12263f;--gray-color:#95aac9;}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:#f5f7fa;color:var(--dark-color);line-height:1.6;background-image:url('https://images.unsplash.com/photo-1579684385127-1ef15d508118?q=80&w=2070&auto=format&fit=crop');background-size:cover;background-attachment:fixed;background-position:center;position:relative;}
body::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.85);z-index:-1;}
.container{max-width:800px;margin:0 auto;padding:20px;position:relative;}
header{text-align:center;margin-bottom:30px;}
header .logo{display:flex;align-items:center;justify-content:center;margin-bottom:15px;gap:15px;}
header .logo img{max-width:80px;height:auto;}
header .logo-text{font-size:24px;font-weight:700;color:var(--primary-color);}
header h1{color:var(--primary-color);margin-bottom:10px;}
header p{color:var(--gray-color);}
form{background:#fff;padding:30px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.05);margin-bottom:30px;}
.form-group{margin-bottom:20px;}
label{display:block;margin-bottom:8px;font-weight:500;}
input[type=text],input[type=tel],input[type=email],textarea{width:100%;padding:12px 15px;border:1px solid #ddd;border-radius:5px;font-size:16px;transition:border .3s;}
input:focus,textarea:focus{outline:none;border-color:var(--primary-color);}
.phone-input{display:flex;align-items:center;}
.phone-input .prefix{background:#f0f2f5;padding:12px 10px;border:1px solid #ddd;border-right:none;border-radius:5px 0 0 5px;font-size:16px;}
.phone-input input{border-radius:0 5px 5px 0;}
.checkbox-group{display:flex;align-items:center;}
.checkbox-group input{width:auto;margin-right:10px;}
.submit-btn{background:var(--primary-color);color:#fff;border:none;padding:12px 25px;font-size:16px;border-radius:5px;cursor:pointer;width:100%;font-weight:500;transition:background .3s;}
.submit-btn:hover{background:#1c6ed8;}
.info-box{background:#fff;padding:20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.05);margin-bottom:30px;}
.info-box h2{color:var(--primary-color);margin-bottom:10px;font-size:20px;}
.tentatif-link{display:inline-block;margin-top:10px;color:var(--primary-color);text-decoration:none;font-weight:500;}
.tentatif-link:hover{text-decoration:underline;}
#confirmationMessage{background:#e8f4ff;padding:20px;border-radius:5px;margin-bottom:20px;display:none;}
#confirmationMessage h2{color:var(--primary-color);margin-bottom:10px;}
.hidden{display:none;}
.counter{background:#fff;padding:15px;border-radius:5px;box-shadow:0 5px 15px rgba(0,0,0,.05);text-align:center;margin-bottom:20px;}
.counter p{font-weight:500;margin-bottom:10px;}
.progress-bar{background:#f0f2f5;height:10px;border-radius:5px;overflow:hidden;}
.progress{background:var(--secondary-color);height:100%;width:0%;transition:width .5s;}
footer{text-align:center;margin-top:30px;color:var(--gray-color);font-size:14px;}
/* — Slider & Tentatif (seperti versi anda) — */
.slider-container{width:100%;margin:0 auto 30px;border-radius:10px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,.1);}
.slider{position:relative;height:300px;}
.slide{position:absolute;width:100%;height:100%;opacity:0;transition:opacity 1s ease-in-out;background-size:contain;background-position:center;background-repeat:no-repeat;background-color:#fff;}
.slide.active{opacity:1;}
.slide-nav{text-align:center;margin-top:10px;}
.slide-nav button{background:var(--primary-color);color:#fff;border:none;padding:5px 10px;margin:0 5px;border-radius:3px;cursor:pointer;}
@media(max-width:600px){.container{padding:15px;}form{padding:20px;}.slider{height:200px;}}
</style>
</head>
<body>
<div class="container">
<header>
  <div class="logo">
      <img src="https://via.placeholder.com/80x80?text=KSS" alt="Logo">
      <span class="logo-text">Klinik SihatSokmo</span>
  </div>
  <h1>Pendaftaran Program "Berjalan Bersama Doktor"</h1>
  <p>10 peserta terawal berpeluang menebus hadiah istimewa!</p>
</header>

<main>
  <!-- SLIDER -->
  <div class="slider-container">
    <div class="slider">
      <div class="slide active" style="background-image:url('https://via.placeholder.com/800x300?text=Poster+1');"></div>
      <div class="slide" style="background-image:url('https://via.placeholder.com/800x300?text=Poster+2');"></div>
      <div class="slide" style="background-image:url('https://via.placeholder.com/800x300?text=Poster+3');"></div>
    </div>
    <div class="slide-nav">
      <button class="slide-btn" data-index="0">1</button>
      <button class="slide-btn" data-index="1">2</button>
      <button class="slide-btn" data-index="2">3</button>
    </div>
  </div>

  <!-- BORANG -->
  <form id="registrationForm">
    <div class="form-group"><label for="fullName">Nama Penuh Peserta:</label><input type="text" id="fullName" required></div>
    <div class="form-group"><label for="icNumber">No. Kad Pengenalan:</label><input type="text" id="icNumber" pattern="[0-9]{6}-[0-9]{2}-[0-9]{4}" placeholder="901231-01-1234" required></div>
    <div class="form-group"><label for="phoneNumber">No. Telefon:</label><div class="phone-input"><span class="prefix">6</span><input type="tel" id="phoneNumber" pattern="[0-9]{9,11}" placeholder="0123456789" required></div></div>
    <div class="form-group"><label for="address">Alamat:</label><textarea id="address" rows="3" required></textarea></div>
    <div class="form-group"><label for="email">Email (optional):</label><input type="email" id="email"></div>
    <div class="form-group checkbox-group"><input type="checkbox" id="agreeTerms" required><label for="agreeTerms">Saya mengakui bahawa maklumat yang diberikan adalah benar.</label></div>
    <button type="submit" class="submit-btn">Daftar Sekarang</button>
  </form>

  <!-- INFO -->
  <div class="info-box"><h2>Tentatif Program</h2><p>Lihat jadual aktiviti untuk hari program.</p><a href="#" id="tentatifBtn" class="tentatif-link">Klik di sini untuk lihat tentatif</a></div>

  <!-- CONFIRMATION -->
  <div id="confirmationMessage" class="hidden"><h2>Pendaftaran Berjaya!</h2><p>Terima kasih kerana mendaftar.</p><p id="earlyBirdMessage"></p><p>Sila hadir ke kaunter pendaftaran dengan kad pengenalan anda.</p></div>

  <!-- COUNTER -->
  <div id="counter" class="counter"><p>Peserta telah mendaftar: <span id="registeredCount">0</span>/10</p><div class="progress-bar"><div class="progress" id="progressBar"></div></div></div>

  <!-- MODAL TENTATIF (ringkas) -->
  <div id="tentatifModal" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;">
    <div style="background:#fff;padding:30px;border-radius:10px;max-width:800px;width:90%;max-height:80vh;overflow-y:auto;">
      <h2 style="color:#2c7be5;text-align:center;margin-bottom:20px;">Tentatif Program</h2>
      <!-- … jadual anda di sini … -->
      <button id="closeModalBtn" style="display:block;margin:20px auto 0;padding:8px 20px;background:#2c7be5;color:#fff;border:none;border-radius:5px;cursor:pointer;">Tutup</button>
    </div>
  </div>
</main>

<footer><p>&copy; 2023 Klinik SihatSokmo. Semua hak cipta terpelihara.</p></footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
 /* ---------- Konfigurasi ---------- */
 const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwRSq4IDDG59UimVrhA226--hAjbJ0tWocnKvoglY706Bvj6R3jOei3iG8IqtpIUwBC/exec';
 const MAX_EARLY_BIRDS   = 10;
 let   registeredCount   = 0;
 let   icSet             = new Set();

 /* ---------- Slider ---------- */
 let currentSlide = 0, intervalId;
 const slides = document.querySelectorAll('.slide'), btns = document.querySelectorAll('.slide-btn');
 function goSlide(i){slides[currentSlide].classList.remove('active');slides[i].classList.add('active');currentSlide=i;}
 function autoSlide(){intervalId=setInterval(()=>goSlide((currentSlide+1)%slides.length),5000);}
 btns.forEach(b=>b.onclick=()=>{clearInterval(intervalId);goSlide(+b.dataset.index);autoSlide();});
 slides.length&&autoSlide();

 /* ---------- Utiliti ---------- */
 const q = id => document.getElementById(id);
 const showError = m => { alert(m); console.error(m); };
 const updateVisual = () => {
   q('registeredCount').textContent = registeredCount;
   q('progressBar').style.width = `${Math.min(100,(registeredCount/MAX_EARLY_BIRDS)*100)}%`;
 };

 /* ---------- Ambil senarai IC & kiraan ---------- */
 async function fetchSheetInfo(){
   try{
     const res = await fetch(GOOGLE_SCRIPT_URL+'?action=list');
     const data= await res.json();
     icSet      = new Set(data.icList);
     registeredCount = data.count;
     updateVisual();
   }catch(err){console.error('Gagal ambil data:',err);}
 }

 /* ---------- Hantar data ---------- */
 async function submitData(payload){
   const res  = await fetch(GOOGLE_SCRIPT_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
   const data = await res.json();
   if(data.status==='duplicate') throw new Error('IC sudah wujud');
   return data;
 }

 /* ---------- Borang ---------- */
 q('registrationForm').addEventListener('submit', async e=>{
   e.preventDefault();
   const ic  = q('icNumber').value.trim();
   if(icSet.has(ic)){ showError('IC ini telah didaftarkan.'); return; }

   const formData={
     fullName:q('fullName').value.trim(),
     icNumber:ic,
     phoneNumber:'6'+q('phoneNumber').value.trim(),
     address:q('address').value.trim(),
     email:q('email').value.trim()||'N/A',
     timestamp:new Date().toISOString()
   };
   if(!q('agreeTerms').checked){showError('Sila setujui terma.');return;}

   try{
     const res = await submitData(formData);
     icSet.add(ic);
     registeredCount = res.count;             // dikembalikan dari server
     updateVisual();
     document.getElementById('registrationForm').style.display='none';
     const early = res.isEarlyBird;
     q('confirmationMessage').style.display='block';
     q('earlyBirdMessage').textContent = early ? 'Tahniah! Anda antara 10 peserta terawal.' : 'Pendaftaran berjaya.';
     q('earlyBirdMessage').style.color = early ? '#2ecc71' : '#e74c3c';
   }catch(err){showError(err.message);}
 });

 /* ---------- Modal ---------- */
 q('tentatifBtn').onclick=e=>{e.preventDefault();q('tentatifModal').style.display='flex';};
 q('closeModalBtn').onclick=()=>q('tentatifModal').style.display='none';
 q('tentatifModal').onclick=e=>{if(e.target===q('tentatifModal'))q('tentatifModal').style.display='none';};

 /* ---------- Input helpers ---------- */
 q('icNumber').oninput=e=>{let v=e.target.value.replace(/\D/g,'');if(v.length>6)v=v.slice(0,6)+'-'+v.slice(6);if(v.length>9)v=v.slice(0,9)+'-'+v.slice(9);e.target.value=v.slice(0,14);};
 q('phoneNumber').oninput=e=>e.target.value=e.target.value.replace(/\D/g,'');

 /* ---------- mula ---------- */
 fetchSheetInfo();
});
</script>
</body>
</html>
